{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .upload-area {
    border: 2px dashed #cbd5e1;
    transition: all 0.3s;
  }
  .upload-area:hover {
    border-color: #3b82f6;
    background: #eff6ff;
  }
  .upload-area.dragover {
    border-color: #3b82f6;
    background: #dbeafe;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">üì¶ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤</h1>
    <p class="text-gray-600">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –Ω—É–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ</p>
  </div>

  <!-- Tabs -->
  <div class="mb-6 border-b border-gray-200">
    <nav class="-mb-px flex space-x-8">
      <button onclick="showTab('import')" id="tab-import" class="tab-btn border-b-2 border-blue-500 py-4 px-1 text-sm font-medium text-blue-600">
        üì• –ò–º–ø–æ—Ä—Ç
      </button>
      <button onclick="showTab('export')" id="tab-export" class="tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
        üì§ –≠–∫—Å–ø–æ—Ä—Ç
      </button>
    </nav>
  </div>

  <!-- –ò–ú–ü–û–†–¢ -->
  <div id="import-section" class="tab-content">
    <form method="post" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %}
      
      <!-- –í—ã–±–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ -->
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
        <label class="block text-sm font-medium text-gray-700 mb-2">–ú–∞–≥–∞–∑–∏–Ω</label>
        <select name="store_id" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          {% for store in stores %}
          <option value="{{ store.id }}">{{ store.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
        <label class="block text-sm font-medium text-gray-700 mb-4">–§–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞</label>
        <div id="upload-area" class="upload-area rounded-lg p-8 text-center cursor-pointer">
          <input type="file" name="import_file" id="file-input" accept=".csv,.json,.xml,.xlsx,.xls" class="hidden" required>
          <div id="upload-placeholder">
            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <p class="mt-2 text-sm text-gray-600">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ <span class="text-blue-600 hover:text-blue-500">–≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</span></p>
            <p class="mt-1 text-xs text-gray-500">CSV, JSON, XML, XLSX (–º–∞–∫—Å. 10 –ú–ë)</p>
          </div>
          <div id="file-info" class="hidden">
            <p class="text-sm font-medium text-gray-900"><span id="file-name"></span></p>
            <p class="text-xs text-gray-500"><span id="file-size"></span></p>
          </div>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∏ -->
      <div class="flex gap-3">
        <button type="submit" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition">
          –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
        </button>
        <a href="{% url 'admin:products_product_changelist' %}" class="px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition">
          –û—Ç–º–µ–Ω–∞
        </a>
      </div>

      <!-- –ò–Ω—Ñ–æ -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="font-medium text-blue-900 mb-2">üí° –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–∞–π–ª—É:</h3>
        <ul class="text-sm text-blue-800 space-y-1">
          <li><strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:</strong> name, category_slug, retail_price</li>
          <li><strong>–§–æ—Ä–º–∞—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</strong> –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞</li>
          <li><strong>CSV:</strong> –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ‚Äî –∑–∞–ø—è—Ç–∞—è (,) –∏–ª–∏ —Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π (;)</li>
          <li><strong>–í–∞—Ä–∏–∞–Ω—Ç—ã:</strong> variant_size, variant_stock, variant_sku (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</li>
        </ul>
      </div>
    </form>
  </div>

  <!-- –≠–ö–°–ü–û–†–¢ -->
  <div id="export-section" class="tab-content hidden">
    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
      <h3 class="text-lg font-medium text-gray-900 mb-4">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞</h3>
      <div class="grid grid-cols-2 gap-4">
        <a href="{% url 'admin:products_product_export' 'csv' %}" class="group block p-6 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition">
          <div class="text-4xl mb-2">üìÑ</div>
          <h4 class="font-medium text-gray-900 group-hover:text-blue-600">CSV</h4>
          <p class="text-sm text-gray-500">–î–ª—è Excel –∏ —Ç–∞–±–ª–∏—Ü</p>
        </a>
        
        <a href="{% url 'admin:products_product_export' 'json' %}" class="group block p-6 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition">
          <div class="text-4xl mb-2">üìã</div>
          <h4 class="font-medium text-gray-900 group-hover:text-blue-600">JSON</h4>
          <p class="text-sm text-gray-500">–î–ª—è API –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</p>
        </a>
        
        <a href="{% url 'admin:products_product_export' 'xml' %}" class="group block p-6 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition">
          <div class="text-4xl mb-2">üìù</div>
          <h4 class="font-medium text-gray-900 group-hover:text-blue-600">XML</h4>
          <p class="text-sm text-gray-500">–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π</p>
        </a>
        
        <a href="{% url 'admin:products_product_export' 'xlsx' %}" class="group block p-6 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition">
          <div class="text-4xl mb-2">üìä</div>
          <h4 class="font-medium text-gray-900 group-hover:text-blue-600">XLSX</h4>
          <p class="text-sm text-gray-500">Excel —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º</p>
        </a>
      </div>
      
      <div class="mt-6 bg-green-50 border border-green-200 rounded-lg p-4">
        <p class="text-sm text-green-800">
          <strong>‚úì –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è:</strong> –í—Å–µ —Ç–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞ –≤–∫–ª—é—á–∞—è –≤–∞—Ä–∏–∞–Ω—Ç—ã (—Ä–∞–∑–º–µ—Ä—ã)
        </p>
      </div>
    </div>
  </div>
</div>

<script>
// Tabs
function showTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
  document.querySelectorAll('.tab-btn').forEach(el => {
    el.classList.remove('border-blue-500', 'text-blue-600');
    el.classList.add('border-transparent', 'text-gray-500');
  });
  
  document.getElementById(tab + '-section').classList.remove('hidden');
  document.getElementById('tab-' + tab).classList.remove('border-transparent', 'text-gray-500');
  document.getElementById('tab-' + tab).classList.add('border-blue-500', 'text-blue-600');
}

// File upload
const uploadArea = document.getElementById('upload-area');
const fileInput = document.getElementById('file-input');
const uploadPlaceholder = document.getElementById('upload-placeholder');
const fileInfo = document.getElementById('file-info');

uploadArea.addEventListener('click', () => fileInput.click());

uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
  uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  const files = e.dataTransfer.files;
  if (files.length) {
    fileInput.files = files;
    showFileInfo(files[0]);
  }
});

fileInput.addEventListener('change', (e) => {
  if (e.target.files.length) {
    showFileInfo(e.target.files[0]);
  }
});

function showFileInfo(file) {
  uploadPlaceholder.classList.add('hidden');
  fileInfo.classList.remove('hidden');
  document.getElementById('file-name').textContent = file.name;
  document.getElementById('file-size').textContent = (file.size / 1024).toFixed(2) + ' KB';
}
</script>
{% endblock %}